# æµ‹è¯•å·¥å…·é›†

æœ¬ç›®å½•åŒ…å«äº†æ™ºèƒ½æç¤ºè¯å·¥ç¨‹å¸ˆç³»ç»Ÿçš„å®Œæ•´æµ‹è¯•å·¥å…·å¥—ä»¶ï¼Œç”¨äºéªŒè¯å‰ç«¯åç«¯è¿æ¥ã€APIé€šä¿¡ã€Agentç³»ç»Ÿç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ“‹ æµ‹è¯•è„šæœ¬æ¦‚è§ˆ

### ğŸ”§ æ ¸å¿ƒæµ‹è¯•è„šæœ¬

| è„šæœ¬åç§° | åŠŸèƒ½æè¿° | é€‚ç”¨åœºæ™¯ | çŠ¶æ€ |
|---------|---------|---------|------|
| `quick-test.mjs` | **å¿«é€Ÿç³»ç»ŸéªŒè¯** | **æ—¥å¸¸æ£€æŸ¥ï¼Œå¿«é€ŸéªŒè¯ç³»ç»ŸçŠ¶æ€** | â­ **å¼ºçƒˆæ¨è** |
| `test-real-api.mjs` | çœŸå®APIè¿æ¥æµ‹è¯• | éªŒè¯APIå¯†é’¥æœ‰æ•ˆæ€§ï¼ŒåŸºç¡€é€šä¿¡æµ‹è¯• | âœ… æ¨èä½¿ç”¨ |
| `test-agent-fixed.mjs` | Agentç³»ç»Ÿä¿®å¤éªŒè¯ | éªŒè¯Agentç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ | âœ… æ¨èä½¿ç”¨ |
| `test-direct.mjs` | ç›´æ¥APIè°ƒç”¨æµ‹è¯• | ç®€å•çš„APIè¿æ¥éªŒè¯ | âœ… åŸºç¡€æµ‹è¯• |
| `diagnose.mjs` | ç¯å¢ƒé…ç½®è¯Šæ–­ | æ£€æŸ¥ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ | âœ… é…ç½®æ£€æŸ¥ |

### ğŸ”„ å®Œæ•´æµç¨‹æµ‹è¯•

| è„šæœ¬åç§° | åŠŸèƒ½æè¿° | é€‚ç”¨åœºæ™¯ | çŠ¶æ€ |
|---------|---------|---------|------|
| `test-full-chat-flow.mjs` | å®Œæ•´å¯¹è¯æµç¨‹æµ‹è¯• | ç«¯åˆ°ç«¯åŠŸèƒ½éªŒè¯ | âš ï¸ éœ€è¦ä¿®å¤ |
| `test-simple-chat.mjs` | ç®€åŒ–æ ¸å¿ƒå¯¹è¯æµ‹è¯• | ç»•è¿‡Agentç³»ç»Ÿçš„åŸºç¡€æµ‹è¯• | âš ï¸ éœ€è¦ä¿®å¤ |
| `test-api.mjs` | APIé›†æˆæµ‹è¯• | æµ‹è¯•å®Œæ•´çš„APIè°ƒç”¨æµç¨‹ | âš ï¸ éœ€è¦ä¿®å¤ |
| `test-simple.mjs` | ç®€å•APIé…ç½®æµ‹è¯• | åŸºç¡€APIé…ç½®éªŒè¯ | âš ï¸ éœ€è¦ä¿®å¤ |

### ğŸ› ï¸ å·¥å…·è„šæœ¬

| è„šæœ¬åç§° | åŠŸèƒ½æè¿° | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|
| `logger.mjs` | æ—¥å¿—ç®¡ç†ç³»ç»Ÿ | ä¸ºæ‰€æœ‰æµ‹è¯•æä¾›ç»Ÿä¸€çš„æ—¥å¿—åŠŸèƒ½ |
| `run-all-tests.mjs` | ç»Ÿä¸€æµ‹è¯•è¿è¡Œå™¨ | æ‰¹é‡è¿è¡Œæ‰€æœ‰æµ‹è¯•è„šæœ¬ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### â­ æ¨èçš„å¿«é€ŸéªŒè¯ï¼ˆæ—¥å¸¸ä½¿ç”¨ï¼‰
```bash
# ä¸€é”®å¿«é€ŸéªŒè¯ç³»ç»ŸçŠ¶æ€ï¼ˆå¼ºçƒˆæ¨èï¼‰
node quick-test.mjs
```

### ğŸ”§ è¯¦ç»†æµ‹è¯•æ­¥éª¤

#### 1. åŸºç¡€ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥APIé…ç½®å’Œç¯å¢ƒå˜é‡
node diagnose.mjs
```

#### 2. APIè¿æ¥éªŒè¯
```bash
# ä½¿ç”¨çœŸå®APIå¯†é’¥æµ‹è¯•è¿æ¥ï¼ˆæ¨èï¼‰
node test-real-api.mjs

# æˆ–è€…ä½¿ç”¨ç®€å•çš„ç›´æ¥APIæµ‹è¯•
node test-direct.mjs
```

#### 3. Agentç³»ç»ŸéªŒè¯
```bash
# éªŒè¯Agentç³»ç»Ÿæ˜¯å¦ä¿®å¤æˆåŠŸ
node test-agent-fixed.mjs
```

---

## ğŸ“– è¯¦ç»†ä½¿ç”¨æŒ‡å—

### ğŸ”§ æ ¸å¿ƒæ¨èè„šæœ¬

#### `quick-test.mjs` - å¿«é€Ÿç³»ç»ŸéªŒè¯ â­ **å¼ºçƒˆæ¨è**
**ç”¨é€”**: æ—¥å¸¸å¿«é€Ÿæ£€æŸ¥ç³»ç»ŸçŠ¶æ€
**ç‰¹ç‚¹**: 
- ä¸€é”®è¿è¡Œæ ¸å¿ƒæµ‹è¯•ç»„åˆ
- æ¶µç›–ç¯å¢ƒé…ç½®ã€APIè¿æ¥ã€Agentç³»ç»Ÿ
- ç”Ÿæˆç®€æ´çš„æµ‹è¯•æŠ¥å‘Š
- æä¾›é’ˆå¯¹æ€§çš„é—®é¢˜å»ºè®®

**è¾“å‡º**: 
- æµ‹è¯•é€šè¿‡ç‡ç»Ÿè®¡
- é—®é¢˜æè¿°å’Œè§£å†³æ–¹æ¡ˆ
- ç³»ç»ŸçŠ¶æ€è¯„ä¼°

```bash
node quick-test.mjs
```

#### `test-real-api.mjs` - çœŸå®APIè¿æ¥æµ‹è¯•
**ç”¨é€”**: éªŒè¯DeepSeek APIå¯†é’¥æœ‰æ•ˆæ€§å’ŒåŸºç¡€é€šä¿¡åŠŸèƒ½
**ç‰¹ç‚¹**: 
- ä½¿ç”¨çœŸå®APIå¯†é’¥
- æµ‹è¯•éæµå¼å’Œæµå¼å“åº”
- æ¨¡æ‹Ÿå‰ç«¯å¯¹è¯æµç¨‹
- æä¾›è¯¦ç»†çš„æ€§èƒ½åˆ†æ

**è¾“å‡º**: 
- APIè¿æ¥çŠ¶æ€
- å“åº”æ—¶é—´åˆ†æ
- æµå¼chunksç»Ÿè®¡
- æ€§èƒ½å»ºè®®

```bash
node test-real-api.mjs
```

#### `test-agent-fixed.mjs` - Agentç³»ç»Ÿä¿®å¤éªŒè¯
**ç”¨é€”**: éªŒè¯AgentçŸ©é˜µç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ
**ç‰¹ç‚¹**:
- æµ‹è¯•AgentåŠ è½½å’Œåˆå§‹åŒ–
- éªŒè¯æ™ºèƒ½è·¯ç”±åŠŸèƒ½
- æµ‹è¯•ä¸åŒAgentç±»å‹çš„å“åº”
- æ¨¡æ‹Ÿå®Œæ•´çš„å‰ç«¯å¯¹è¯æµç¨‹

```bash
node test-agent-fixed.mjs
```

#### `diagnose.mjs` - ç¯å¢ƒé…ç½®è¯Šæ–­
**ç”¨é€”**: æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒé…ç½®æ˜¯å¦æ­£ç¡®
**ç‰¹ç‚¹**:
- æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- éªŒè¯é…ç½®æ–‡ä»¶å­˜åœ¨æ€§
- æä¾›é…ç½®å»ºè®®
- ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š

```bash
node diagnose.mjs
```

#### `test-direct.mjs` - ç›´æ¥APIè°ƒç”¨æµ‹è¯•
**ç”¨é€”**: æœ€ç®€å•çš„APIè¿æ¥éªŒè¯
**ç‰¹ç‚¹**:
- ç›´æ¥è°ƒç”¨OpenAI SDK
- æœ€å°åŒ–ä¾èµ–
- å¿«é€ŸéªŒè¯APIå¯†é’¥

```bash
node test-direct.mjs
```

### ğŸ”„ å®Œæ•´æµç¨‹æµ‹è¯•

#### `test-full-chat-flow.mjs` - å®Œæ•´å¯¹è¯æµç¨‹æµ‹è¯•
**ç”¨é€”**: ç«¯åˆ°ç«¯çš„å®Œæ•´åŠŸèƒ½æµ‹è¯•
**ç‰¹ç‚¹**:
- æ¨¡æ‹Ÿå‰ç«¯å‘é€æ¶ˆæ¯
- æµ‹è¯•Agentè·¯ç”±å’Œå“åº”
- éªŒè¯æµå¼å“åº”æœºåˆ¶
- ç”Ÿæˆå®Œæ•´æµ‹è¯•æŠ¥å‘Š

**æ³¨æ„**: ç›®å‰éœ€è¦ä¿®å¤Agentæ–‡ä»¶åŠ è½½é—®é¢˜

#### `test-simple-chat.mjs` - ç®€åŒ–æ ¸å¿ƒå¯¹è¯æµ‹è¯•
**ç”¨é€”**: ç»•è¿‡Agentç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
**ç‰¹ç‚¹**:
- ç›´æ¥æµ‹è¯•LLMæœåŠ¡
- é¿å…Agentç³»ç»Ÿå¤æ‚æ€§
- ä¸“æ³¨äºAPIé€šä¿¡éªŒè¯

---

## ğŸ“Š æµ‹è¯•ç»“æœæ–‡ä»¶

æ‰€æœ‰æµ‹è¯•è„šæœ¬éƒ½ä¼šåœ¨`test/`ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

### æ—¥å¿—æ–‡ä»¶
- **ç»Ÿä¸€æ—¥å¿—ç›®å½•**: `logs/` (é¡¹ç›®æ ¹ç›®å½•)
- `logs/test-*.log` - æµ‹è¯•è„šæœ¬æ‰§è¡Œæ—¥å¿—
- `logs/frontend-*.log` - å‰ç«¯è¿è¡Œæ—¥å¿—
- `logs/backend-*.log` - åç«¯æœåŠ¡æ—¥å¿—
- `logs/system-*.log` - ç³»ç»Ÿçº§æ—¥å¿—
- åŒ…å«æ—¶é—´æˆ³ã€æ‰§è¡Œè¿‡ç¨‹ã€é”™è¯¯ä¿¡æ¯ç­‰

### JSONæŠ¥å‘Šæ–‡ä»¶
- `real-api-diagnosis.json` - APIè¿æ¥è¯Šæ–­æŠ¥å‘Š
- `agent-fix-evaluation.json` - Agentä¿®å¤è¯„ä¼°æŠ¥å‘Š
- `test-report.json` - ç»Ÿä¸€æµ‹è¯•è¿è¡ŒæŠ¥å‘Š
- `simple-chat-test-report.json` - ç®€åŒ–å¯¹è¯æµ‹è¯•æŠ¥å‘Š

### é”™è¯¯æŠ¥å‘Šæ–‡ä»¶
- `*-error-report.json` - å„ç§æµ‹è¯•çš„é”™è¯¯æŠ¥å‘Š
- `chat-flow-error-report.json` - å¯¹è¯æµç¨‹é”™è¯¯æŠ¥å‘Š

---

## ğŸ” é—®é¢˜æ’æŸ¥æŒ‡å—

### 1. APIè¿æ¥é—®é¢˜
**ç—‡çŠ¶**: APIè°ƒç”¨å¤±è´¥ã€è®¤è¯é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥APIå¯†é’¥é…ç½®
node diagnose.mjs

# 2. æµ‹è¯•ç›´æ¥APIè¿æ¥
node test-direct.mjs

# 3. ä½¿ç”¨çœŸå®APIå¯†é’¥æµ‹è¯•
node test-real-api.mjs
```

### 2. Agentç³»ç»Ÿé—®é¢˜
**ç—‡çŠ¶**: AgentåŠ è½½å¤±è´¥ã€è·¯ç”±é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
```bash
# éªŒè¯Agentä¿®å¤æ•ˆæœ
node test-agent-fixed.mjs

# æŸ¥çœ‹AgentåŠ è½½æ—¥å¿—
cat test-*.log | grep Agent
```

### 3. å‰ç«¯å¡ä½é—®é¢˜
**ç—‡çŠ¶**: å‰ç«¯å‘é€æ¶ˆæ¯åæ— å“åº”
**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥APIè¿æ¥
node test-real-api.mjs

# 2. éªŒè¯Agentç³»ç»Ÿ
node test-agent-fixed.mjs

# 3. æŸ¥çœ‹å®Œæ•´æ—¥å¿—
cat test-*.log
```

### 4. æµå¼å“åº”é—®é¢˜
**ç—‡çŠ¶**: æµå¼æ˜¾ç¤ºä¸å·¥ä½œã€chunksç¼ºå¤±
**è§£å†³æ–¹æ¡ˆ**:
```bash
# æµ‹è¯•æµå¼APIå“åº”
node test-real-api.mjs

# æ£€æŸ¥æµå¼æ€§èƒ½
grep "æµå¼" test-*.log
```

---

## ğŸ› ï¸ å¼€å‘è€…æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•è„šæœ¬
1. åˆ›å»ºæ–°çš„`.mjs`æ–‡ä»¶
2. å¯¼å…¥`logger.mjs`ç”¨äºæ—¥å¿—è®°å½•
3. åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶
4. å®ç°æµ‹è¯•é€»è¾‘
5. ç”ŸæˆJSONæŠ¥å‘Šæ–‡ä»¶
6. æ›´æ–°æœ¬READMEæ–‡æ¡£

### æµ‹è¯•è„šæœ¬æ¨¡æ¿
```javascript
#!/usr/bin/env node

import path from 'path';
import logger from './logger.mjs';
import { config } from 'dotenv';

// åŠ è½½ç¯å¢ƒå˜é‡
const fs = await import('fs');
const envFiles = ['.env.local', '.env', 'env.example'];
for (const file of envFiles) {
  const filePath = path.join(process.cwd(), file);
  if (fs.existsSync(filePath)) {
    config({ path: filePath });
    console.log(`âœ… å·²åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶: ${file}`);
    break;
  }
}

// æ¸…ç†æ—§æ—¥å¿—
logger.info('ğŸ§¹ æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶...');
logger.constructor.cleanup(10);

// å¼€å§‹æµ‹è¯•
logger.startTest('æµ‹è¯•åç§°');

async function runTest() {
  try {
    // æµ‹è¯•é€»è¾‘
    console.log('æµ‹è¯•æ‰§è¡Œä¸­...');
    
    // ä¿å­˜ç»“æœ
    const report = { /* æµ‹è¯•ç»“æœ */ };
    const reportFile = path.join(process.cwd(), 'test', 'test-result.json');
    fs.writeFileSync(reportFile, JSON.stringify(report, null, 2));
    
    return report;
  } catch (error) {
    logger.error('âŒ æµ‹è¯•å¤±è´¥', { error: error.message });
    throw error;
  }
}

// è¿è¡Œæµ‹è¯•
const startTime = Date.now();
runTest().then(() => {
  const duration = Date.now() - startTime;
  logger.endTest('æµ‹è¯•åç§°', duration, true);
  console.log('âœ… æµ‹è¯•å®Œæˆ');
}).catch(error => {
  const duration = Date.now() - startTime;
  logger.endTest('æµ‹è¯•åç§°', duration, false);
  console.error('âŒ æµ‹è¯•å¤±è´¥:', error.message);
});
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **APIå¯†é’¥å®‰å…¨**: ç¡®ä¿ä¸è¦åœ¨æ—¥å¿—ä¸­æš´éœ²å®Œæ•´çš„APIå¯†é’¥
2. **æ–‡ä»¶æƒé™**: ç¡®ä¿testç›®å½•æœ‰è¯»å†™æƒé™
3. **ç½‘ç»œè¿æ¥**: æµ‹è¯•éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥è®¿é—®DeepSeek API
4. **Node.jsç‰ˆæœ¬**: å»ºè®®ä½¿ç”¨Node.js 18+ç‰ˆæœ¬
5. **ä¾èµ–å®‰è£…**: ç¡®ä¿æ‰€æœ‰ä¾èµ–åŒ…å·²æ­£ç¡®å®‰è£…

---

## ğŸ¯ æ¨èæµ‹è¯•æµç¨‹

### æ—¥å¸¸å¼€å‘æµ‹è¯•
```bash
# 1. å¿«é€Ÿæ£€æŸ¥
node diagnose.mjs

# 2. APIéªŒè¯
node test-real-api.mjs

# 3. AgentéªŒè¯
node test-agent-fixed.mjs
```

### é—®é¢˜æ’æŸ¥æµç¨‹
```bash
# 1. ç¯å¢ƒè¯Šæ–­
node diagnose.mjs

# 2. APIè¿æ¥æµ‹è¯•
node test-direct.mjs

# 3. å®Œæ•´åŠŸèƒ½æµ‹è¯•
node test-agent-fixed.mjs

# 4. æŸ¥çœ‹æ—¥å¿—
cat test-*.log
```

---

**æœ€åæ›´æ–°**: 2025-10-04  
**ç»´æŠ¤è€…**: Claude Code Assistant